<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>输入工程密码页面</title>
<script type="text/javascript" src="/smart_hotel/js/sbory.js"></script>
<script type="text/javascript">
/**************全局变量声明**********************/
var oHistory		= new $.plugs.history(),
	bindPos			= 0,//输入框
	btnPos			= 0,//确定与取消按钮
	lastFocusArea	= 0,
	count=0,//确认键的个数
	password="",
	focusArea		= 0;//0:开机画面;1:绑定弹出框;2:错误提示框.
/****************按键处理**********************/
$.plugs.keyProcess = function(key,keyObj) {
	var p2 = keyObj.p2;
	switch(key) {
			case "LEFT":
				keyLeftRight(-1);
				break;
			case "RIGHT":
				keyLeftRight(1);
				break;
			case "UP":
				keyUpDown(-1);
				break;
			case "DOWN":
				keyUpDown(1);
				break;
			case "OK":
				doOk();
				break;
			case "BACK":
				if(focusArea==1 && bindPos<1){
					if(count>0){
						count--;
						var str="";
						for(var i=1;i<=count;i++){
							str+="*";
						}
						password=str;
						$("input0").text(password);
					}
					return;
				}
				break;
			case "EXIT":
					window.location.href=oHistory.back();	
				break;
			case "F2":
				location.href = location.href;
				break;
			default:
				return 1;
		}	
		return 0;
}

/**************左右键处理*****************/
function keyLeftRight(__num){
	switch(focusArea){
		case 0:
			
			break;
		case 1:
			if(bindPos<1){
				if(inputObj!=null)inputObj.moveCursor(__num);
				return;
			}
			setFocusStyle(0);
			btnPos = (btnPos+__num+2)%2;
			setFocusStyle(1);
			break;
		case 6:
			keyboard.moveKeyboard(__num>0?4:3);
			break;
		
	}
}
/**************上下键处理*****************/
function keyUpDown(__num){
	switch(focusArea){
		case 0:
			
			break;
		case 1:
			setFocusStyle(0);
			bindPos = (bindPos+__num+2)%2;
			setFocusStyle(1);
			break;
		case 6:
			keyboard.moveKeyboard(__num>0?2:1);
			break;
	}
}

/**************确定键处理*****************/
function doOk(){
	switch(focusArea){
		case 0:
			break;
		case 1:
			if(bindPos<1){
				if(count>=6){
				   keyUpDown(1);
				}else{
					count++;
					password+="*";
					$('input0').text(password);
				}
			}else {
				if(btnPos==0){
					bindStb();
				}else { 
					exitTo();
				}
			}
			break;
		case 2:
			changeFocusArea(0);
			if(authErrorFlag){
				exitToTv();
				break
			}
			authStb();
			break;
	}
}

function changeFocusArea(__num){
	switch(focusArea){
		case 0:
			setFocusStyle(0);
			break;
		case 1:
			setFocusStyle(0);
			if(__num!=6){
				$('bind').hide();
			}
			break;
	}
	lastFocusArea = focusArea;
	focusArea = __num;
	
	switch(focusArea){
		case 0:
			setFocusStyle(1);
			break;
		case 1:
			setFocusStyle(1);
			break;
		case 2:
			$('err_tip').show();
			break;
	}
}
/**************处理焦点样式****************/

function setFocusStyle(__num){
	switch(focusArea){
		case 0:
			break;
		case 1:
			if(bindPos<1){
				$('input'+bindPos).bgImage('image/input_bg'+__num+'.png');
			}else{
				$('btn'+btnPos).bgImage('image/vod_bnt'+__num+'.png').color(__num>0?'#ffffff':'#626262');
			}
			break;
	}
}

function bindStb(){
	var Code =  $('input0').text();
	if(Code!=='******'){
		showTips('工程密码不正确');
		return;
	}else{
	    var curl=$.url.query("currUrl");
		urlCmdMap(curl);
	}
}
var tipTimer = -1;
function showTips(msg){
	$('tip').text(msg);
		clearTimeout(tipTimer);
		tipTimer = setTimeout(function(){
			$('tip').text('进系统设置前请输入工程密码');
			keyUpDown(-1);
		},1000);
}

function exitTo(){
	location.href=oHistory.back();
}

function init(){
	changeFocusArea(1);
}

</script>



</head>

<body leftmargin="0" topmargin="0" bgcolor="white" onLoad="init();">
<div style="position:absolute;	left:265px;	top:125px;	width:749px;	height:469px; background:url(image/bind_bg.png) no-repeat center;visibility:visible;" id="bind">
	<div  style="position:absolute; left: 81px; top: 151px;">
		<table border="0" cellspacing="0" cellpadding="0" style=" height: 120px;">
		  <tr>
		    <td width="188" style="color:#ffffff;font-size:30px; text-align:right; padding-right:20px;">输入密码</td>
		    <td width="352" style="background:url(image/input_bg0.png) no-repeat left;padding-left:5px; font-size:30px;"  id="input0"></td>
		  </tr>
		</table>
	</div>
	<div style="color:#383838; position:absolute; font-size:28px; left: 46px; top: 283px; width: 657px; text-align:center;" id="tip">进系统设置前请输入工程密码</div>
	<div style="position:absolute; left: 144px; top: 347px; width:173px; height:71px; background:url(image/vod_bnt0.png) no-repeat center; color:#626262; font-size:32px; line-height:71px; text-align:center;" id="btn0">确&nbsp;认</div>
	<div style="position:absolute; left: 427px; top: 347px; width:173px; height:71px;background:url(image/vod_bnt0.png) no-repeat center; color:#626262; font-size:32px; line-height:71px; text-align:center;" id="btn1">取&nbsp;消</div>
</div>
</body>
</html>
